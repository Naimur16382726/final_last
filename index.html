<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Ad System</title>
    <style>
        /* Previous CSS with improvements */
        .notification {
            background: rgba(255, 59, 48, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }
        .countdown {
            font-size: 14px;
            color: #4ecca3;
            margin-top: 10px;
            text-align: center;
        }
        #ad-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            display: none;
        }
    </style>
    <script src='//whephiwums.com/vignette.min.js' data-zone='8975809' data-sdk='show_8975809'></script>
</head>
<body>
    <!-- Container remains same -->

    <!-- Hidden Ad Container -->
    <div id="ad-container"></div>

    <script>
        const ADS_INTERVAL = 20000; // 20 seconds
        const ADS_LIMIT = 500;
        const PAUSE_DURATION = 120000; // 2 minutes

        let currentAd = null;
        let adTimer = null;
        let sessionCount = 0;

        // Improved Ad Handler
        function showAd() {
            if(typeof show_8975809 === 'function') {
                // Close previous ad
                if(currentAd) closeAd();

                // Show new ad
                currentAd = show_8975809({
                    container: document.getElementById('ad-container'),
                    onClose: () => {
                        console.log("Ad closed");
                        sessionCount++;
                        updatePoints();
                        scheduleNextAd();
                    }
                });

                // Auto-close after 20s
                adTimer = setTimeout(() => {
                    if(currentAd) currentAd.close();
                }, 20000);
            }
        }

        function closeAd() {
            if(currentAd) {
                clearTimeout(adTimer);
                currentAd.close();
                currentAd = null;
            }
        }

        // Advanced Scheduler
        function scheduleNextAd() {
            if(sessionCount >= ADS_LIMIT) {
                handleAdLimit();
                return;
            }

            setTimeout(() => {
                showAd();
                updateCountdown();
            }, ADS_INTERVAL);
        }

        function handleAdLimit() {
            // Special ad click
            triggerSpecialAd();
            
            setTimeout(() => {
                sessionCount = 0;
                scheduleNextAd();
            }, PAUSE_DURATION);
        }

        function triggerSpecialAd() {
            // Implement special ad logic
            console.log("Special ad triggered");
        }

        // Start Auto Ads
        function startAutoAds() {
            showAd();
            updateCountdown();
        }

        // Remaining code (countdown, UI updates etc.)
    </script>
</body>
</html>
